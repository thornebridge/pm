services:
  postgres:
    image: postgres:17-alpine
    ports: ["5432:5432"]
    environment:
      POSTGRES_DB: pm
      POSTGRES_USER: pm
      POSTGRES_PASSWORD: pm
    volumes: ["pgdata:/var/lib/postgresql/data"]

  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]

  meilisearch:
    image: getmeili/meilisearch:v1.12
    ports: ["7700:7700"]
    environment:
      MEILI_ENV: development
    volumes: ["msdata:/meili_data"]

  app:
    build: .
    ports: ["3000:3000"]
    depends_on: [postgres, redis, meilisearch]
    environment:
      DATABASE_URL: postgres://pm:pm@postgres:5432/pm
      REDIS_URL: redis://redis:6379
      MEILISEARCH_HOST: http://meilisearch:7700
    profiles: ["production"]

volumes:
  pgdata:
  msdata:
